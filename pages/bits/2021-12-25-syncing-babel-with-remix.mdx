---
title: 'Syncing Babel with Remix'
blurb: 'How to make Remix work with Babel macros.'
description: 'How to make Remix work with Babel macros.'
publishedAt: '2021-12-25'
editedAt: '2021-12-25'
---

A few months back I tweeted about trying to move this website from `next-mdx-enhanced` to `mdx-bundler`. The reason was one word: **colocation**.

## The Colocation Problem

`next-mdx-enhanced` was great because it allowed me to write a Next.js page as MDX. Every MDX file in the `pages/` folder would be treated as an individual page, and `next-mdx-enhanced` would handle the responsibility of converting it to a Next.js page component. This would be great if all I'm writing is simple markdown, but my blog posts tend to be highly interactive — various React components are sprinkled _everywhere_ in my blog posts. These components need to be defined _somewhere_, and the best place for their source code would be right next to where they're being used, e.g.

```
pages/
  my-post/
    index.mdx   <- the blog post
    components/ <- components for the blog post
      component-a.tsx
      component-b.tsx
```

Unfortunately, Next doesn't have a mechanism for "skipping" certain files or folders. Everything in the `pages/` folder _will_ be turned to a routable page, meaning I'm going to end up with pages for everything in the `components/` folder.

In order to stay with `next-mdx-enhanced`, I gave up on the colocation dream. Currently, all the compnents for a post live in an "umbrella" components folder with subfolders for each post:

```
src/
  pages/
    my-post.mdx
  components/
    my-post/
      component-a.tsx
      component-b.tsx
```

This _works_, but admittedly, I'm not super happy about it.

## Enter MDX Bundler

In truth, I wasn't ready to give up on the colocation dream just yet. I _really_ like having everything I need for a post live in one place so it's easy to refer to the components, import them, and make changes to them.

A while later I learned about [mdx-bundler](), a tool that compiles and bundles up your MDX into a string that you can evaluate in the front-end. "Perfect!" I thought. "I can finally make colocation work for Not a Number!" This led to me spending a few hours one morning trying to migrate my content over to mdx-bundler.

Ultimately, the refactor never happened — I faced too many compatibility issues between my website and mdx-bundler that I thought it wasn't worth the effort. The main problem was the compatibility with **Babel macros**.

- Why does it work with `next-mdx-enhanced`?
  - Because `next-mdx-enhanced` converts the mdx file to a React component, then the macro runs _after_ this conversion
- Why does it not work with `mdx-bundler`?

  - MDX bundler attempts to bundle the mdx file and all its dependencies using `esbuild`
  - This means `esbuild` will try to bundle the Babel macro together with the MDX component
  - Of course this doesn't work because Babel macros are meant to run during _build_ time, which means it depends on Node libraries that don't exist in the browser
  - `esbuild` will see these libraries up in its dependency tree and try to compile them together with the MDX
  - I gave up trying to do this conversion because I didn't think it was worth the effort at the time

- Fast forward a few months and Remix went open source
- I've been following the development of Remix for a while and was really excited about this release; I tried it as soon as it became available
